<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¨ÙˆØª Ø§Ù„Ø£Ù…Ø§Ù†</title>
<link rel="icon" href="https://i.ibb.co/Hq8V39j/image.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Cairo', Arial, sans-serif;
        background: #1a1a1a;
        color: #ffffff;
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header {
        background-color: #2c2c2c;
        color: white;
        padding: 20px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
    }
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
    }
    h1 { margin: 0; font-size: 2rem; }
    .user-info { display: flex; align-items: center; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; margin-left: 10px; object-fit: cover; }
    .guild-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 120px; }
    .guild-card {
        background-color: #2c2c2c;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s ease forwards;
        animation-delay: var(--delay, 0s);
    }
    .guild-card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(255,255,255,0.1); }
    .guild-icon { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; }
    .guild-name { font-size: 1.2rem; margin-bottom: 15px; color: #ffffff; }
    .btn { display: inline-block; padding: 10px 20px; background-color: #4caf50; color: white; text-decoration: none; border-radius: 5px; transition: background-color 0.3s ease; font-weight: bold; }
    .btn:hover { background-color: #45a049; }
    .no-guilds { text-align: center; margin-top: 40px; font-size: 1.2rem; color: #aaa; }
    .language-toggle, .refresh-btn {
        background-color: #45a049;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-left: 10px;
        font-weight: bold;
    }
    .language-toggle:hover, .refresh-btn:hover { background-color: #3d8b40; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<header>
    <div class="header-content">
        <div style="display: flex; align-items: center;">
            <img src="https://i.ibb.co/Hq8V39j/image.png" alt="Safety Bot Logo" class="bot-logo" style="width: 40px; height: 40px; margin-right: 10px;">
            <h1 id="dashboard-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        </div>
        <div style="display:flex; align-items:center;">
            <div class="user-info">
                <img src="<%= user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png' %>" alt="<%= user.username %>" class="user-avatar">
                <span><%= user.username %></span>
            </div>
            <button class="refresh-btn" onclick="loadGuilds()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            <button class="language-toggle" onclick="toggleLanguage()" id="lang-toggle-btn">ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©</button>
        </div>
    </div>
</header>
<main class="container">
    <div class="guild-list" id="guildList">
        <div class="no-guilds" id="no-guilds-msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª...</div>
    </div>
</main>

<script>
async function loadGuilds() {
    const guildList = document.getElementById('guildList');
    guildList.innerHTML = '';

    try {
        const res = await fetch('/api/user-guilds'); 
        const guilds = await res.json();

        if (!guilds.length) {
            guildList.innerHTML = '<div class="no-guilds" id="no-guilds-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ±ÙØ±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
            return;
        }

        guilds.forEach((guild, index) => {
            const card = document.createElement('div');
            card.classList.add('guild-card');
            card.style.setProperty('--delay', `${index * 0.1}s`);
            card.innerHTML = `
                <img src="${guild.icon ? `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png'}" alt="${guild.name}" class="guild-icon">
                <h2 class="guild-name">${guild.name}</h2>
                <a href="/dashboard/${guild.id}" class="btn">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</a>
            `;
            guildList.appendChild(card);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        toggleLanguage(true);

    } catch(err) {
        console.error(err);
        guildList.innerHTML = '<div class="no-guilds">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª.</div>';
    }
}

function toggleLanguage(keepCurrent=false) {
    const html = document.documentElement;
    const dashboardTitle = document.getElementById('dashboard-title');
    const langToggleBtn = document.getElementById('lang-toggle-btn');
    const manageServerBtns = document.querySelectorAll('.btn');
    const noGuildsMsg = document.getElementById('no-guilds-msg');

    // Ù„Ùˆ Ø¬Ø§ÙŠ Ù…Ù† loadGuilds() Ø®Ù„ÙŠÙ‡ Ø¨Ù†ÙØ³ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    let lang = keepCurrent ? html.lang : (html.lang === 'ar' ? 'en' : 'ar');

    if (lang === 'en') {
        html.lang = 'en';
        html.dir = 'ltr';
        dashboardTitle.textContent = 'Dashboard';
        langToggleBtn.textContent = 'Change Language';
        manageServerBtns.forEach(btn => btn.textContent = 'Manage Server');
        if (noGuildsMsg) noGuildsMsg.textContent = 'No servers available at the moment.';
    } else {
        html.lang = 'ar';
        html.dir = 'rtl';
        dashboardTitle.textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…';
        langToggleBtn.textContent = 'ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©';
        manageServerBtns.forEach(btn => btn.textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±');
        if (noGuildsMsg) noGuildsMsg.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ±ÙØ±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.';
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
window.addEventListener('load', loadGuilds);

// Ù…Ù†Ø¹ ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (F12) ÙˆØ§Ù„Ù†Ù‚Ø± ÙŠÙ…ÙŠÙ†
document.onkeydown = function(e){
    if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && ['I','C','J'].includes(String.fromCharCode(e.keyCode))) || (e.ctrlKey && e.keyCode==85)) return false;
};
document.oncontextmenu = e=>{ e.preventDefault(); return false; };
</script>
</body>
</html>
